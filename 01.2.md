# 1.2 $GOPATH и рабочее пространство

## $GOPATH

Работа всех команд Go основана на использовании одной главной и важной переменной окружения под названием `$GOPATH`. Обратите внимание, что переменная `$GOROOT`, где установлен Go, не имеет к ней никакого отношения. Эта переменная указывает на расположение рабочей папки или рабочего пространства на вашем компьютере. (Я использую этот путь на своем компьютере, а если вы не имеете такую ​​же структуру каталогов, пожалуйста, настройте ее самостоятельно.)

В Unix-подобных системах, значение `GOPATH` устанавливается вот так:
	
	export GOPATH=/home/apple/mygo
	
В Windows Вам нужно создать новую переменную окружения под названием GOPATH, затем установить ее значение в `c:\mygo`( ***Это значение может быть другим в зависимости от того, где расположено Ваше рабочее пространство*** )

Никто не запрещает использовать более одной папки(рабочего пространства) в `$GOPATH`, но не забывайте использовать символ-разделитель `:`(`;` в Windows) для их разделения между собой. Заметим, что `go get` будет сохранять контент в первую папку, указанную в $GOPATH.

В папке $GOPATH должны быть такие подпапки:

- `src` для исходных файлов с расширением `.go, .c, .g, .s`.
- `pkg` для скомпилированных файлов с расширением `.a`.
- `bin` для исполняемых файлов

В своей книге я использую папку `mygo` как единственную в `$GOPATH`.

## Пакеты

Создайте папку и файл `$GOPATH/src/mymath/sqrt.go` (`mymath` это имя пакета) ( ***Автор использует `mymath` в качестве имени пакета, а потому папка с исходным кодом имеет такое же название***)

Каждый раз создавая пакет, Вам нужно создавать новую подпапку в папке`src`, причем ее название обычно совпадает с названием пакета, который будет использоваться. Вы можете создать многоуровневую структуру каталогов, если конечно вам это необходимо. Например, создав папку `$GOPATH/src/github.com/astaxie/beedb`, путь к вашему пакету будет `github.com/astaxie/beedb`. А названием пакета будет последняя папка в пути, в данном примере это `beedb`.

А пока выполните следующие комнады. ( ***Автор возвращается к примеру*** )

	cd $GOPATH/src
	mkdir mymath
	
Создайте новый исходный файл под названием `sqrt.go`, вот примерно с таким содержимым:

	// Исходный код в файле $GOPATH/src/mymath/sqrt.go
	package mymath
	
	func Sqrt(x float64) float64 {
		z := 0.0
		for i := 0; i < 1000; i++ {
			z -= (z*z - x) / (2 * x)
		}
		return z
	}
	
На данный момент папка пакета создана, а работа с кодом завершена. Я рекомендовал бы вам сохранить имя пакета и название папки, содержащей исходные коды пакета.

## Компиляция пакетов

Мы уже создали свой пакет, однако нам надо бы научиться его компилировать. Существует два способа сделать это:

- Перейдите из вашей рабочей папки в папку пакета, а затем выполните `go install`.
- Выполните предыдущую команду, указав название файла, например `go install mymath`.

После компиляции мы можем открыть следующую папку:

	cd $GOPATH/pkg/${GOOS}_${GOARCH}
	// вы увидите, что был создан вот такой файл
	mymath.a
	
Файл с суффиксом `.a` скомпилированная бинарная версия нашего пакета.

Но чтобы этот пакет принес нам пользу, нужно создать приложение, которое будет его использовать.

Создайте новую папку для пакета приложения под названием `mathapp`.

	cd $GOPATH/src
	mkdir mathapp
	cd mathapp
	vim main.go
	
Код: 

	//$GOPATH/src/mathapp/main.go
	package main
	
	import (
		"mymath"
		"fmt"
	)
	
	func main() {
		fmt.Printf("Hello, world. Sqrt(2) = %v\n", mymath.Sqrt(2))
	}
	
Для компиляции вам нужно переключиться в папку приложения, в данном случае это `$GOPATH/src/mathapp`, а затем выполнить `go install`. После этого вы должны увидеть, что исполняемый файл под названием `mathapp` был создан в папке `$GOPATH/bin/`. Чтобы запустить приложений, используйте команду `./mathapp`, а выполнив, вы должны увидеть следующее у себя в терминале:

	Hello world. Sqrt(2) = 1.414213562373095
	
## Установка пакетов из удаленных источников

Go имеет специальный инструмент для установки пакетов из удаленных источников, название ему `go get`. Инструмент поддерживает большинство open source сервисов, включая Github, Google Code, BitBucket, и Launchpad.

	go get github.com/astaxie/beedb
	
Можно также использовать `go get -u …` для обновления удаленных пакетов, эта команда также автоматически установит все зависимости для пакета.

Этот инструмент будет использовать различные системы контроля версий в зависимости от платформы. Например, это будет `git` для Github или `hg` для Google Code. Не забудьте только установить эти инструменты перед использованием `go get`.

После выполнения предыдущих команд структура папок должна стать примерно такой:

	$GOPATH
		src
		 |-github.com
		 	 |-astaxie
		 	 	 |-beedb
		pkg
		 |--${GOOS}_${GOARCH}
		 	 |-github.com
		 	 	 |-astaxie
		 	 	 	 |-beedb.a
		 	 	 	 
Вообще, `go get` копирует исходные коды в `$GOPATH/src` локальной файловой системы, а затем выполняет `go install`.

Использование удаленных пакетов практически такое же, как если бы мы использовали локальные пакеты:

	import "github.com/astaxie/beedb"
	
## Полная структура

Если Вы следовали предыдущим шагам и выполнили все корректно, то структура Вашей папки будет такой:

	bin/
		mathapp
	pkg/
		${GOOS}_${GOARCH}, например darwin_amd64, linux_amd64
      mymath.a
      github.com/
        astaxie/
          beedb.a
	src/
		mathapp
			main.go
		mymath/
			sqrt.go
		github.com/
			astaxie/
				beedb/
					beedb.go
					util.go
					
Теперь мы можем увидеть всю структуру папок, `bin` содержит исполняемые файлы, в `pkg` скомпилированные, а `src` содержит исходный код.

( ***Формат переменной окружения в Windows вообще говоря такой - `%GOPATH%`, однако эта книга использует в основном Unix-style, потому Windows пользователи должны будут заменить переменную своим значением.*** )

## Ссылки

- [Содержание](preface.md)
- Предыдущая секция: [Установка](01.1.md)
- Следующая секция: [Команды Go](01.3.md)
